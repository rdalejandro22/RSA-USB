#include "ElGamal.h"
#include "Funciones Matematicas.h"
#include "RSA.h"
#include <time.h>
using namespace std;
using namespace NTL;
int main()
{

    srand(time(NULL));

    /*string mensaje;
    ifstream texto;
    texto.open("mensaje.txt");
    getline(texto,mensaje);
    texto.close();
    ZZ e, N;
    e = string_toZZ("93176920439996414013989278609269688926505986719277750616320368058202487423570001041545950261551990516801215640871053037156537484933631714889585167830243728439957187320988447459058883737545001122446443101215656331503452821696567949572357267445944726072592404806581695383906557144481781651135263146320963465453");
    N = string_toZZ("22832149413817924386474699868475353122724304479123292244360848802143623699141174328312138718116864701615834242653801421447097450670986894894200203915428732765860057057874016126566916684905419452746713088422778510029267228115267692440284822472822136197802736820494948065275250109716714693551485159566657982823034231187676031927574992071286784464882780856840276975077482664508498661850319671008192112257644421688718148570336300178668695014303727044764635167037866161421628468131129297007472098049890829701676421480433939644874320441598084580127096148848394635478171058260278929619000560084032170153984250289229087960763");
    RSA emisor(e,N);
    string mensaje_cifrado = emisor.cifrar(mensaje);
    cout << mensaje_cifrado;
    ofstream m_c;
    m_c.open ("mensaje_cifrado.txt");
    m_c << mensaje_cifrado;
    m_c.close();
    /*RSA recepetor(2048);
    ZZ md, mp ,mq, mn;
    md = string_toZZ("190504549975022377461695167156847205087154852742594199538255959681184659087484669103477475265459122227171334748436192700095826336609202454621229518777852644708206484501356172087612519443141497263748763294461867308802633263461143837402822238038191289185057877149346359212798303522274453063918614375107961195591197499601236669031225125562840184951951654220216188898792526153534041796948036281186041936631330705718192203224839924646738537862034230498429237335569081969944667932204951418993989754651003152372098719588928423217191324073336315110272175933225024840915709042415796979908912151821822207343147113787915110154303367119358738612620624730929565218579603510543922621940312708541135897746633131838368333502637827242152055176529179463384867321486358286461360506061983753466005340849388111704674056620671174208255959585672822144426646394963402296905815010453950406172675326942338540026971412345520576325207411056326408645299418153905516943312452501875285075777954150625588050545896999999518184348345563343465518072119331458265466269724558998309604080348851953683491744864993194629711188633191654555159144426117651552137804701051579031322146870883845613887079391014629720391368817763284996276413367132489277370364774234552481824733");
    mp = string_toZZ("9255258006555546875936622787516868355184736705196640806674887247770288292148135421573179783683217416595410133536960994307853812536542388335263877009401730584406646006248210699855049607845830979733242269202087498646322884185847773105016526222922436512522490564776747349185178224879573625544331616568483879908135320596007616429460686406771124940830318829711616841318999473756945555688301319342401589919642292480350569769009588641981929533083487929688991114319046167615006767719686043417204734149133814919907017684184949862040606850176079838142770782189596644719253204732638554307147882652314119147317178484405762751433");
    mq = string_toZZ("1290930020277760627614577820323303435481884893091467897072025451925330306031288458952628566317159009467832408896121119577624658989919826369810695984569848689731777866177422531569673412645706490291105467384926585322210448595529936981019140052237369357323894910041260565898637880191093747695499672511583297434350099097631556265242810206699231047823204848227116584300029499837072121321204775990186466319764596842913161805317540084987317026235363329683350528475249118812471007379736449390484372981301709854318006901790874164752066145495558182995552891310782670898984199205204296926694179955488988579382895252748838932251");
    mn = string_toZZ("11947890406078658532299517076608364591530742315178045936604727252023870880718769810992735940744166728865805779976186084985519110276737237610997658500522728591168467854315302861600428292153941799927935252554117858131718167015905985358285451019894260081629980202928630285015577268908853629484195561428838690195237491056535171821131758971047590715810948007774681012682489463753452729863391386683032914094202659592575106701728821194318481559720055111502188489302233542354622148402298179951320689674978412405010622493015836059286614414906156513787984085785056036822529041588571634366447678599981298638850927110090511675900902747679399284637120608653054320905023712838582657988433630440481151655235269521976785746497568410345050628358694351974023981453977284232050836987135075784956501160341262385563338320181122648319505694827791351838971094541774043977878141225210204779209960346057325782863178372136418552332477035513573323878392844068607146878398458978573314296722202502946766009625005600147565664516164084961573282238521267805074249826400072180577652750093640434449490099326038773756082537573435834133449264266387938291442885052548686286848775978749570995822018650703182132583545858788283929451770748993465990161553729130315640165683");
    string valer = "0736459412256747470912148121516490666970181795461623092028850938234328321732667543211600168455791864961283292299379904935640733202906254310735451335197822859524747383717555805517230060734642402682700600965437874772213159024216199606506876570791379426848528992765608471713332795704220356215082897231804233748540735513566592202418597788736210411299163883025635029540555609384175429762166466410443077268392209446300001711698446815866413333256973060496095906222175748338510086148196629878273909215694237331560972822866064545498216208924781049651057821384467664434466109656573296896916259178534888896194702263489257318541066259717228753355959537378890259888052376654163471345784220730942311063648011203844238681122960906134043212483010926741133278820113883119398028535536365829415809607167110058564605161010478560508926443276517279091679169466802229884858277409009091326297720568357436464246814144782741021935805322432408841701818403267783761187348843245072467620516074895155716377041000127746249083629102488079156428147562717137797435803950703784468837470324139689446845165402391955523917104517163168912839683951116187935550802934353800957658370111458220938331692715065555748735633940982888080611790337635811437782088222786698807869506206351084848609263390744715854223296218625810701008477971281118544688636189837816933000908347678311843822939058094939798808708527583934260027149738795169011983318972059375621793617604366844970396538029193058330368009778596631593178756531057319739904406532240543378886909123794962506031619352906184099199658152557760455846850982396168618802148681865549169887267701382203414457529898300336151517910608452793558528572444966668008609755836592998904772894633676794683663025928227755758599422669543385599054275032603298826833768694524751951112685683259899478830721344656426162265909202265090433969330755198008773712298818700886744394532484545185915536473341313887305139941682212099464054005012198215433921550926458758417923864494665136373495960889672898220015021622777416874919109672039867792873929056997531856519631571234124433592551483130827605334310969455830344774420076914668812974572464161600113619903086651553749776556072173965243237891956480601752591097996084628043324640296227396469579765647482551891489505839158075111875964199809807945566945547215119792818457791421925496438083207208906228147012814085815838857327333969248270536348246625516197639371697632248992959309015457550697590752322765448755454883559620753936125051943131246";
    string anthony = "0147897921712086962100931767066701895691011035542519081851139444218090495563173378788659942696051813896769896167036947176583739361340112048288983221075386532063408165241758956606758262414849808397470374329784181820920955712424647631952698125277205238673741481378186433040640052088953063851844322532750747427522436207140551503257622200805844971294994956591826439502514755094950813066353663517272069922102039162028843214186896889420767875464125918858229512998868576591549378849533709492794027932841364740315070057488902710017372546678628909444425119710634274223783749698541010229680974923631594558031513986155866642245430116313011881122804991792758649088521168999028637561419813537102490100719467674884213376561092913186289556964438634483535258853265594428862595141441496492881756260214515423265788525363347923656936604236323810643889712103297628428202103088319616616284935731896388160534006347412276982047130879409016579233623478885148368553127378932072617811683646882993557056831197846551256178419459783894495539704933318415633068281836250395024439119562515510395624659747563082220233790046965885192809861446177927776189399770041582961819412329864320305507357794164865480600909670356263325080839423781799650510995137478428837493271106489042240408367028179056035390667791074589669467527155986348745887647848758933305442200038496858154497476387916116130414832884232703264417604226121452645296622269876763939987363028100253833990529291422985485300438336478867294110970922032187224534031870518052989141864262451718595399459975522612652273035002633669471876228582105547876050829301715553396269016492045124743966985661956621073285229012554406486134747530494464400195841969174644588014058861782609040150298528273698943581857077499384798689054796927111221904596080702258598662855799802045313208583360922732987773850311217770195233497993895045735699553943160842994189420700628317375007261616779313997689261660234374516172909903169147270381274389840723136459290632290672073911628663823587123903557564338425158532217541888107127969216281086000750634839532228148141202144370516031628821441746584197857510012473127667064136092743971373150624933037097406134481698123068810083346917598999532436897504503846668125948730371735878975739684871525938378282936027206839669875326556792960275715752015869438004212775961372906689710216468118910868400585883734374371589024240416419074318997360136175572527960164534458479912461561147384408683685500731797320477917676314644523441770622589174";
    //string paulo = "";
    string abel = "0443918052902930772272288596452489203592960936284120333119022706622564558655644314886122441772261222370403282737187363239887260963306526130313791946672840289264604278450189663326868038036406122332741728942764605356021158473439120596315541120710206699838288840746785597752577783478372234646251955965427110651099766285421896060124808728728707656448950306524841138314906310108390400904828646774219414899660026865959368361280400013899533065170921577448517818815762284077659967802919953904394774551134989201494667152374555045746939401128647740775853271895781038406754513152095247534254667528171445692575071681655816396853355766693160363013276691610422510218105740221230361707437367796429841717957874289853549059398663894861259411329085851375324594598724049685832788973302720484905287074236156642765137043615979600423676092866423006873334927834811980072559114646109240405645953071896449719926515553033284318725282796271769320616996139052554018719523433388506195134619939596714712643366760672430998731911708315706750329537678118422723649925500808868650681110873893176207989221513225883092177399544424270662337250532525967218389244142192743683548885151899015824033005208292910354274503964047162390189245913533519975350621319710291311313840106351084848609263390744715854223296218625810701008477971281118544688636189837816933000908347678311843822939058094939798808708527583934260027149738795169011983318972059375621793617604366844970396538029193058330368009778596631593178756531057319739904406532240543378886909123794962506031619352906184099199658152557760455846850982396168618802148681865549169887267701382203414457529898300336151517910608452793558528572444966668008609755836592998904772894633676794683663025928227755758599422669543385599054275032603298826833768694524751951112685683259899478830721344656426162265909202265090433969330755198008773712298818700886744394532484545185915536473341313887305139941682212099464054005012198215433921550926458758417923864494665136373495960889672898220015021622777416874919109672039867792873929056997531856519631571234124433592551483130827605334310969455830344774420076914668812974572464161600113619903086651553749776556072173965243237891956480601752591097996084628043324640296227396469579765647482551891489505839158075111875964199809807945566945547215119792818457791421925496438083207208906228147012814085815838857327333969248270536348246625516197639371697632248992959309015457550697590752322765448755454883559620753936125051943131246";
    recepetor.set_d(md);
    recepetor.set_p(mp);
    recepetor.set_q(mq);
    recepetor.set_N(mn);
    cout << recepetor.descifrar(anthony);*/

    /*ElGamal Receptor(1024);
    ZZ d, P;
    d = string_toZZ("58473852540463838493385124837043530462041443737213238445996489868836081590968451079461805872811655028036897678682762163634415268588817273553409131510443851658229519206763808614252485341008840585285402943522203628087098441104506408776651211673617489605646791349130957833611453021180467820316728240085381240647");
    P = string_toZZ("204361134910517928051029023652861682570489264478753655207344596942877842907167345235490101328122006665463529286391153300042421020284623313092284747470474769308779058141598912784167447517751281192247728333180741479594717393634037417277965775247135817341498846041989820846218778974475427794993657538207270464683");
    Receptor.set_d(d);
    Receptor.set_P(P);

    /*string mensaje = "Luis Mariquito";
    /*ifstream texto;
    texto.open("mensaje.txt");
    getline(texto,mensaje);
    texto.close();*/

    /*ZZ e_1, e_2, P;
    e_1 = string_toZZ("151536533917962246409012252591204905181635060601051882697744594385119743478993310022177234607237334129640423771723741084743360100441284742004903889390306887904648196103115358763845747674632005484601940258725675678169628349360174681858601927174556993173697563124070046922782622612556619885169638482821502588656");
    e_2 = string_toZZ("34191248097698275627023961474335397646506341951306687114169975520690421898213087087577643463100440500917640803751458447753886818892147334234435608929704746626012134413844658365747740287174950879309757130019022049986186063193286388181374539936164033268839907450275642388643951747392787894542176978899662596938");
    P = string_toZZ("151536533917962246409012252591204905181635060601051882697744594385119743478993310022177234607237334129640423771723741084743360100441284742004903889390306887904648196103115358763845747674632005484601940258725675678169628349360174681858601927174556993173697563124070046922782622612556619885169638482821502588659");

    ElGamal Emisor(e_1, e_2, P, 1024);
    string mensaje_cifrado = Emisor.cifrar(mensaje);
    cout << mensaje_cifrado << endl;
    ofstream m_c;
    m_c.open ("mensaje_cifrado_gamal.txt");
    m_c << "Mensaje: " << mensaje_cifrado;
    m_c.close();

    /*cout << endl;
    //c1 = string_toZZ("44889023306725899946917475958844817376807278349072199350052282446446191042077904215721728035108602637498122607643288892902724185705198014565607713820465447205745214665398779339586902198768596486610422120078563636323933336871158057028122727902840284196340029258938456433968690618268199100625580736836769133943");
    */
    //string mensaje_cifrado = "135702539135868099002397656371411491375062980775237952749504596065842449742450803984843000239492526688905640887039619180409107569384784517110316988918914556842844565113526923478973121150499318719343405742270333910458320956869083245536667287705950229498740296900509212689247117420057634803352726956071774574164002698968510788332951500009278278418247433275148648904357732484182934746493229458248685393541034569212106207500236476413996750894230380035554760893132873890970284319504645238106855317069029931866758441942420431113889057851502841716845766333668883120265041839582791436261513583785392249329176179947927634541980140004116573397172388769403988870009394184709357902818970197790552331989848083927292183301912406924814268854374494180808704684161309959642348635917015944300517932237157659904397171838713094163153742523422864255533317156649287812660043045503602928796831173588607866543937178475363474811137084860917094363836722";
    /*string p = "33472998247964457832535623508768012603";
    ZZ C1;
    string c1;
    string m_c;
    for(int i = 0; i < p.size(); i++)
    {
        c1 += mensaje_cifrado[i];
    }
    for(int i = p.size(); i < mensaje_cifrado.size(); i++)
    {
        m_c += mensaje_cifrado[i];
    }
    C1 = string_toZZ(c1);*/
    //cout << Receptor.descifrar(mensaje_cifrado);

    /*string mensaje = "Mensaje de prueba con firma.";
    string firma = " Alejandro Risco alejandro.risco@ucsp.edu.pe";
    RSA receptor(1024);
    ZZ pubkey_receptor, n_receptor;
    pubkey_receptor = receptor.get_e();
    n_receptor = receptor.get_n();
    RSA emisor(pubkey_receptor, n_receptor);
    string mensaje_cifrado = emisor.cifrar(mensaje, firma);
    cout << receptor.descifrar(mensaje_cifrado, emisor.get_e(), emisor.get_n());*/


    string firma = "Alejandro Risco";
    string mensaje = "Esta prueba ojala funcione";
    RSA receptor(256);
    RSA emisor(256, receptor.get_e(), receptor.get_n());
    string mensaje_cifrado = emisor.cifrar(mensaje, firma);
    cout << receptor.descifrar(mensaje_cifrado, emisor.get_tamfirma(), emisor.get_e(), emisor.get_n());















}
